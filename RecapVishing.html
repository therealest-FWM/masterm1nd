<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level Recap</title>
  <link rel="icon" type="image/webp" href="assets/MMLogo.webp">
  <link rel="stylesheet" href="results.css">
  <!-- Preload next level background video -->
  <link rel="preload" as="video" href="assets/EmailBG.mp4" type="video/mp4">
  <style>
    /* Phishing Recap Specific Overrides */
    .result-card {
      padding: 2.5rem 3rem;
      max-height: 90vh;
      overflow-y: auto;
      width: 85%;
    }

    h1 {
      font-size: 3.5rem;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }

    .stats-grid {
      margin: 1.5rem 0;
      padding: 1rem;
      gap: 3rem;
    }

    .stat-value {
      font-size: 1.8rem;
    }

    .lesson-box {
      margin-top: 1.5rem;
      padding: 1rem;
    }

    .lesson-box p {
      font-size: 1.1rem;
      line-height: 1.5;
      margin-bottom: 0;
    }

    .action-buttons {
      margin-top: 2rem;
      gap: 1.5rem;
    }

    .cyber-btn {
      padding: 12px 30px;
      font-size: 0.9rem;
    }

    /* Scrollbar styling for aesthetic */
    .result-card::-webkit-scrollbar {
      width: 8px;
    }

    .result-card::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }

    .result-card::-webkit-scrollbar-thumb {
      background: var(--neon-green);
      border-radius: 4px;
    }
  </style>
  <script src="./Recap.js"></script>
</head>

<body>
  <div class="result-card success-theme">
    <h1>Vishing Avoided!</h1>
    <h2>Level Recap</h2>

    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-value" id="time">--:--</span>
      </div>
      <div class="stat-item">
        <span class="stat-value score" id="score">★★★</span>
      </div>
    </div>

    <div class="lesson-box">
      <p id="lesson">Voice phihsing or Vishing is a type of phishing attack where the attacker is impersonating someone
        else by imitating their voice, usually the attacker will use a voice of a known figure but recently the
        attackers
        started using AI to trick people. Impressive accomplishment in successfully finishing the Vishing
        level!
        You can usually figure out if you are talking to an AI through the small stuff like how they pronunce certin
        things.</p>
    </div>

    <div class="action-buttons">
      <button type="button" class="cyber-btn btn-green" id="retry" onclick="retry()">Retry</button>
      <button type="button" class="cyber-btn btn-green" id="continue" onclick="cont()">Continue</button>
      <button type="button" class="cyber-btn btn-green" onclick="quitToMainMenu()">Quit</button>
    </div>
  </div>

  <script>
    /*****************************
     *  BACKGROUND MUSIC (PER PAGE)
     *****************************/
    let bgMusic = null;

    if (localStorage.getItem("audioUnlocked") === "true") {
      const introSFX = new Audio("assets/success-48018-(right).mp3");
      introSFX.volume = 0.5;
      introSFX.play().catch(() => { });

      bgMusic = new Audio("assets/Stars.mp3"); // Recap theme
      bgMusic.loop = true;
      bgMusic.volume = 0.05;
      bgMusic.preload = "auto";
      bgMusic.play().catch(() => { });
    }

    function retry() {
      // var retryBut = document.getElementById("retry"); // unused var removed
      window.location.href = 'Vishing.html'
    }
    function cont() {
      window.location.href = 'EmailPhishing.html'
    }
    window.onload = function () {
      var y = document.getElementById("time");
      var totalTimeInSeconds = localStorage.getItem('totalTimeInSecondsVishing');
      var scoreDisplay = document.querySelector(".score");

      if (totalTimeInSeconds === null) {
        totalTimeInSeconds = 0;
      } else {
        totalTimeInSeconds = parseFloat(totalTimeInSeconds);
      }

      if (y) {
        y.textContent = "Time: " + totalTimeInSeconds.toFixed(1) + "s";
      }

      if (scoreDisplay) {
        let stars = 0;
        // Allowing more time for 3 stars because of voice clips (e.g., 40s instead of 20s)
        if (totalTimeInSeconds <= 90) {
          scoreDisplay.textContent = "★★★";
          stars = 3;
        } else if (totalTimeInSeconds <= 120) {
          scoreDisplay.textContent = "★★☆";
          stars = 2;
        } else {
          scoreDisplay.textContent = "★☆☆";
          stars = 1;
        }
        sessionStorage.setItem('stats_phish_vishing', JSON.stringify({ stars, time: totalTimeInSeconds }));
      }
    };
    /*****************************
    *  QUIT BUTTON
    *****************************/
    function quitToMainMenu() {
      window.location.href = "LevelSelect.html";
    }
  </script>
</body>

</html>