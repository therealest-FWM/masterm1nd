<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level Recap</title>
  <link rel="icon" type="image/webp" href="assets/MMLogo.webp">
  <link rel="stylesheet" href="results.css">
  <!-- Preload next level background video -->
  <link rel="preload" as="video" href="assets/SMSBG.mp4" type="video/mp4">
  <style>
    /* Phishing Recap Specific Overrides */
    .result-card {
      padding: 2.5rem 3rem;
      max-height: 90vh;
      overflow-y: auto;
      width: 85%;
    }

    h1 {
      font-size: 3.5rem;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }

    .stats-grid {
      margin: 1.5rem 0;
      padding: 1rem;
      gap: 3rem;
    }

    .stat-value {
      font-size: 1.8rem;
    }

    .lesson-box {
      margin-top: 1.5rem;
      padding: 1rem;
    }

    .lesson-box p {
      font-size: 1.1rem;
      line-height: 1.5;
      margin-bottom: 0;
    }

    .action-buttons {
      margin-top: 2rem;
      gap: 1.5rem;
    }

    .cyber-btn {
      padding: 12px 30px;
      font-size: 0.9rem;
    }

    /* Scrollbar styling for aesthetic */
    .result-card::-webkit-scrollbar {
      width: 8px;
    }

    .result-card::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }

    .result-card::-webkit-scrollbar-thumb {
      background: var(--neon-green);
      border-radius: 4px;
    }
  </style>
  <script src="./Recap.js"></script>
</head>

<body>
  <div class="result-card success-theme">
    <h1>Spear Phishing Avoided!</h1>
    <h2>Level Recap</h2>

    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-value" id="time">--:--</span>
      </div>
      <div class="stat-item">
        <span class="stat-value score" id="score">★★★</span>
      </div>
    </div>

    <div class="lesson-box">
      <p id="lesson">Spear phishing is a type of phishing attack where the attacker is targeting you personally rather
        than targeting multiple people at once, it usually contains personal information. Outstanding achievement in
        completing the first phishing level though! No matter the type of phishing attack you should never
        follow
        links if you don't know where they came from.</p>
    </div>

    <div class="action-buttons">
      <button type="button" class="cyber-btn btn-green" id="retry" onclick="retry()">Retry</button>
      <button type="button" class="cyber-btn btn-green" id="continue" onclick="cont()">Continue</button>
      <button type="button" class="cyber-btn btn-green" onclick="quitToMainMenu()">Quit</button>
    </div>
  </div>

  <script>
    /*****************************
     *  BACKGROUND MUSIC (PER PAGE)
     *****************************/
    let bgMusic = null;

    if (localStorage.getItem("audioUnlocked") === "true") {
      const introSFX = new Audio("assets/success-48018-(right).mp3");
      introSFX.volume = 0.5;
      introSFX.play().catch(() => { });

      bgMusic = new Audio("assets/Stars.mp3"); // Recap theme
      bgMusic.loop = true;
      bgMusic.volume = 0.05;
      bgMusic.preload = "auto";
      bgMusic.play().catch(() => { });
    }

    function retry() {
      // var retryBut = document.getElementById("retry"); // unused var removed
      window.location.href = 'SPhishing.html'
    }
    function cont() {
      window.location.href = 'SMSishing.html'
    }
    window.onload = function () {
      var y = document.getElementById("time");
      var totalTimeInSeconds4 = localStorage.getItem('totalTimeInSeconds4');
      var scoreDisplay = document.querySelector(".score");

      if (totalTimeInSeconds4 === null) {
        totalTimeInSeconds4 = 0;
      } else {
        totalTimeInSeconds4 = parseFloat(totalTimeInSeconds4);
      }

      if (y) {
        y.textContent = "Time: " + totalTimeInSeconds4.toFixed(1) + "s";
      }

      if (scoreDisplay) {
        let stars = 0;
        if (totalTimeInSeconds4 <= 15) {
          scoreDisplay.textContent = "★★★";
          stars = 3;
        } else if (totalTimeInSeconds4 <= 30) {
          scoreDisplay.textContent = "★★☆";
          stars = 2;
        } else {
          scoreDisplay.textContent = "★☆☆";
          stars = 1;
        }
        sessionStorage.setItem('stats_phish_spear', JSON.stringify({ stars, time: totalTimeInSeconds4 }));
      }
    };
    /*****************************
    *  QUIT BUTTON
    *****************************/
    function quitToMainMenu() {
      window.location.href = "LevelSelect.html";
    }
  </script>
</body>

</html>