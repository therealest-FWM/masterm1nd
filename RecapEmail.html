<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level Recap</title>
  <link rel="icon" type="image/webp" href="assets/MMLogo.webp">
  <link rel="stylesheet" href="results.css">
  <!-- Preload next level cutscene video -->
  <link rel="preload" as="video" href="assets/NetworkCutScene.mp4" type="video/mp4">
  <style>
    /* Phishing Recap Specific Overrides */
    .result-card {
      padding: 2.5rem 3rem;
      max-height: 90vh;
      overflow-y: auto;
      width: 85%;
    }

    h1 {
      font-size: 3.5rem;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }

    .stats-grid {
      margin: 1.5rem 0;
      padding: 1rem;
      gap: 3rem;
    }

    .stat-value {
      font-size: 1.8rem;
    }

    .lesson-box {
      margin-top: 1.5rem;
      padding: 1rem;
    }

    .lesson-box p {
      font-size: 1.1rem;
      line-height: 1.5;
      margin-bottom: 0;
    }

    .action-buttons {
      margin-top: 2rem;
      gap: 1.5rem;
    }

    .cyber-btn {
      padding: 12px 30px;
      font-size: 0.9rem;
    }

    /* Scrollbar styling for aesthetic */
    .result-card::-webkit-scrollbar {
      width: 8px;
    }

    .result-card::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }

    .result-card::-webkit-scrollbar-thumb {
      background: var(--neon-green);
      border-radius: 4px;
    }
  </style>
  <script src="./Recap.js"></script>
</head>

<body>
  <div class="result-card success-theme">
    <h1>Phishing Avoided!</h1>
    <h2>Level Recap</h2>

    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-value" id="time">--:--</span>
      </div>
      <div class="stat-item">
        <span class="stat-value score" id="score">★★★</span>
      </div>
    </div>

    <div class="lesson-box">
      <p id="lesson">Way to go on finishing the phishing levels! Notice how both legitimate Emails ask you to
        communicate through already agreed upon secure chanels and insist that you verify your identity on a consistent
        basis, it never a good idea to handle sensitive information through links or messages. Hope you learned how to
        tell if you're being scammed or not.</p>
    </div>

    <div class="action-buttons">
      <button type="button" class="cyber-btn btn-green" id="retry" onclick="retry()">Retry</button>
      <button type="button" class="cyber-btn btn-green" id="continue" onclick="cont()">Continue</button>
      <button type="button" class="cyber-btn btn-green" onclick="quitToMainMenu()">Quit</button>
    </div>
  </div>

  <script>
    /*****************************
     *  BACKGROUND MUSIC (PER PAGE)
     *****************************/
    let bgMusic = null;

    if (localStorage.getItem("audioUnlocked") === "true") {
      const introSFX = new Audio("assets/success-48018-(right).mp3");
      introSFX.volume = 0.5;
      introSFX.play().catch(() => { });

      bgMusic = new Audio("assets/Stars.mp3"); // Recap theme
      bgMusic.loop = true;
      bgMusic.volume = 0.05;
      bgMusic.preload = "auto";
      bgMusic.play().catch(() => { });
    }

    function retry() {
      // var retryBut = document.getElementById("retry"); // unused var removed
      window.location.href = 'EmailPhishing.html'
    }
    function cont() {
      // var continueBut = document.getElementById("continue"); // unused var removed
      window.location.href = ' NetworksCS.html'
    }
    window.onload = function () {
      var y = document.getElementById("time");
      var totalTimeInSeconds = localStorage.getItem('totalTimeInSecondsEmail');
      var livesLeft = localStorage.getItem('livesRemainingEmail');
      var scoreDisplay = document.querySelector(".score");

      if (totalTimeInSeconds === null) {
        totalTimeInSeconds = 0;
      } else {
        totalTimeInSeconds = parseFloat(totalTimeInSeconds);
      }

      if (livesLeft === null) {
        livesLeft = 3;
      } else {
        livesLeft = parseInt(livesLeft);
      }

      if (y) {
        y.textContent = "Time: " + totalTimeInSeconds.toFixed(1) + "s";
      }

      if (scoreDisplay) {
        let stars = 0;
        // Stars based on lives remaining (3 lives total)
        if (livesLeft === 3) {
          scoreDisplay.textContent = "★★★";
          stars = 3;
        } else if (livesLeft === 2) {
          scoreDisplay.textContent = "★★☆";
          stars = 2;
        } else {
          scoreDisplay.textContent = "★☆☆";
          stars = 1;
        }
        sessionStorage.setItem('stats_phish_email', JSON.stringify({ stars, time: totalTimeInSeconds }));
      }
    };
    /*****************************
    *  QUIT BUTTON
    *****************************/
    function quitToMainMenu() {
      window.location.href = "LevelSelect.html";
    }
    sessionStorage.setItem('levelUnlocked', '3'); // Unlock Networks
  </script>
</body>

</html>